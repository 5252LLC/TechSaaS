<!-- Create Incident Modal -->
<div class="modal fade" id="createIncidentModal" tabindex="-1" aria-labelledby="createIncidentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createIncidentModalLabel">Create New Security Incident</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="create-incident-form">
                    <div class="mb-3">
                        <label for="incident-title" class="form-label">Incident Title</label>
                        <input type="text" class="form-control" id="incident-title" required>
                    </div>
                    <div class="mb-3">
                        <label for="incident-description" class="form-label">Description</label>
                        <textarea class="form-control" id="incident-description" rows="3" required></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="incident-severity" class="form-label">Severity</label>
                            <select class="form-select" id="incident-severity" required>
                                <option value="">Select severity...</option>
                                <option value="CRITICAL">Critical</option>
                                <option value="HIGH">High</option>
                                <option value="MEDIUM">Medium</option>
                                <option value="LOW">Low</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="incident-type" class="form-label">Type</label>
                            <select class="form-select" id="incident-type" required>
                                <option value="">Select type...</option>
                                <option value="DATA_BREACH">Data Breach</option>
                                <option value="ACCOUNT_COMPROMISE">Account Compromise</option>
                                <option value="API_ABUSE">API Abuse</option>
                                <option value="INFRASTRUCTURE_ATTACK">Infrastructure Attack</option>
                                <option value="MALWARE">Malware</option>
                                <option value="DENIAL_OF_SERVICE">Denial of Service</option>
                                <option value="OTHER">Other</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="incident-source" class="form-label">Source</label>
                            <input type="text" class="form-control" id="incident-source" placeholder="How was this detected?" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="affected-resources" class="form-label">Affected Resources</label>
                            <input type="text" class="form-control" id="affected-resources" placeholder="Comma-separated list of affected systems">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="affected-users" class="form-label">Affected Users</label>
                            <input type="text" class="form-control" id="affected-users" placeholder="Comma-separated list of affected users">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="save-incident">Create Incident</button>
            </div>
        </div>
    </div>
</div>

<!-- Create from Anomaly Modal -->
<div class="modal fade" id="anomalyIncidentModal" tabindex="-1" aria-labelledby="anomalyIncidentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="anomalyIncidentModalLabel">Create Incident from Anomaly</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="anomaly-incident-form">
                    <div class="mb-3">
                        <label for="anomaly-selector" class="form-label">Select Anomaly</label>
                        <select class="form-select" id="anomaly-selector" required>
                            <option value="">Select an anomaly...</option>
                            <!-- Anomalies will be populated via JavaScript -->
                        </select>
                    </div>
                    <div id="anomaly-details" class="d-none">
                        <div class="card mb-3">
                            <div class="card-header">Anomaly Details</div>
                            <div class="card-body">
                                <p class="mb-1"><strong>Type:</strong> <span id="anomaly-type"></span></p>
                                <p class="mb-1"><strong>Severity:</strong> <span id="anomaly-severity"></span></p>
                                <p class="mb-1"><strong>Description:</strong> <span id="anomaly-description"></span></p>
                                <p class="mb-1"><strong>Detected:</strong> <span id="anomaly-detected"></span></p>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="additional-notes" class="form-label">Additional Notes</label>
                            <textarea class="form-control" id="additional-notes" rows="2" placeholder="Add any additional context or information"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="create-from-anomaly" disabled>Create Incident</button>
            </div>
        </div>
    </div>
</div>

<!-- Incident Details Modal -->
<div class="modal fade" id="incidentDetailsModal" tabindex="-1" aria-labelledby="incidentDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="incidentDetailsModalLabel">Incident Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row" id="incident-details-container">
                    <!-- Tabs for different incident sections -->
                    <ul class="nav nav-tabs" id="incidentDetailTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">Overview</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="timeline-tab" data-bs-toggle="tab" data-bs-target="#timeline" type="button" role="tab" aria-controls="timeline" aria-selected="false">Timeline</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="containment-tab" data-bs-toggle="tab" data-bs-target="#containment" type="button" role="tab" aria-controls="containment" aria-selected="false">Containment</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="evidence-tab" data-bs-toggle="tab" data-bs-target="#evidence" type="button" role="tab" aria-controls="evidence" aria-selected="false">Evidence</button>
                        </li>
                    </ul>
                    
                    <!-- Tab content -->
                    <div class="tab-content p-3 border border-top-0 rounded-bottom" id="incidentDetailTabsContent">
                        <!-- Overview Tab -->
                        <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="card h-100">
                                        <div class="card-header">Incident Summary</div>
                                        <div class="card-body">
                                            <h5 id="detail-title" class="card-title"></h5>
                                            <p id="detail-description" class="card-text"></p>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <p class="mb-1"><strong>ID:</strong> <span id="detail-id"></span></p>
                                                    <p class="mb-1"><strong>Status:</strong> <span id="detail-status"></span></p>
                                                    <p class="mb-1"><strong>Severity:</strong> <span id="detail-severity"></span></p>
                                                    <p class="mb-1"><strong>Type:</strong> <span id="detail-type"></span></p>
                                                </div>
                                                <div class="col-md-6">
                                                    <p class="mb-1"><strong>Created:</strong> <span id="detail-created"></span></p>
                                                    <p class="mb-1"><strong>Updated:</strong> <span id="detail-updated"></span></p>
                                                    <p class="mb-1"><strong>Source:</strong> <span id="detail-source"></span></p>
                                                    <p class="mb-1"><strong>Assigned To:</strong> <span id="detail-assigned"></span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card h-100">
                                        <div class="card-header">Affected Resources</div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <h6>Systems/Resources</h6>
                                                    <ul id="detail-resources" class="list-group list-group-flush">
                                                        <!-- Will be populated via JavaScript -->
                                                    </ul>
                                                </div>
                                                <div class="col-md-6">
                                                    <h6>Users</h6>
                                                    <ul id="detail-users" class="list-group list-group-flush">
                                                        <!-- Will be populated via JavaScript -->
                                                    </ul>
                                                </div>
                                            </div>
                                            
                                            <div class="mt-3" id="anomaly-container">
                                                <h6>Related Anomaly</h6>
                                                <p id="detail-anomaly">No related anomaly</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Status Update Form -->
                            <div class="card mb-3">
                                <div class="card-header">Update Status</div>
                                <div class="card-body">
                                    <form id="status-update-form" class="row align-items-end">
                                        <div class="col-md-4">
                                            <label for="new-status" class="form-label">New Status</label>
                                            <select class="form-select" id="new-status" required>
                                                <option value="">Select status...</option>
                                                <option value="new">New</option>
                                                <option value="investigating">Investigating</option>
                                                <option value="contained">Contained</option>
                                                <option value="resolved">Resolved</option>
                                                <option value="false_positive">False Positive</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="status-notes" class="form-label">Notes</label>
                                            <input type="text" class="form-control" id="status-notes" placeholder="Optional notes about this status change">
                                        </div>
                                        <div class="col-md-2">
                                            <button type="button" class="btn btn-primary w-100" id="update-status-btn">Update</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                            <!-- Assignment Form -->
                            <div class="card">
                                <div class="card-header">Assign Incident</div>
                                <div class="card-body">
                                    <form id="assign-form" class="row align-items-end">
                                        <div class="col-md-6">
                                            <label for="assignee" class="form-label">Assign To</label>
                                            <select class="form-select" id="assignee" required>
                                                <option value="">Select assignee...</option>
                                                <!-- Will be populated via JavaScript -->
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="assignment-notes" class="form-label">Notes</label>
                                            <input type="text" class="form-control" id="assignment-notes" placeholder="Optional assignment notes">
                                        </div>
                                        <div class="col-md-2">
                                            <button type="button" class="btn btn-primary w-100" id="assign-btn">Assign</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Timeline Tab -->
                        <div class="tab-pane fade" id="timeline" role="tabpanel" aria-labelledby="timeline-tab">
                            <div class="card mb-3">
                                <div class="card-header">Add Timeline Event</div>
                                <div class="card-body">
                                    <form id="event-form" class="row g-3">
                                        <div class="col-md-4">
                                            <label for="event-type" class="form-label">Event Type</label>
                                            <select class="form-select" id="event-type" required>
                                                <option value="">Select type...</option>
                                                <option value="investigation">Investigation</option>
                                                <option value="finding">Finding</option>
                                                <option value="action">Action Taken</option>
                                                <option value="notification">Notification</option>
                                                <option value="analysis">Analysis</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                        <div class="col-md-8">
                                            <label for="event-description" class="form-label">Description</label>
                                            <input type="text" class="form-control" id="event-description" required>
                                        </div>
                                        <div class="col-md-12">
                                            <label for="event-details" class="form-label">Details (Optional)</label>
                                            <textarea class="form-control" id="event-details" rows="2"></textarea>
                                        </div>
                                        <div class="col-12 text-end">
                                            <button type="button" class="btn btn-primary" id="add-event-btn">Add Event</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="timeline-container">
                                <ul class="timeline" id="incident-timeline">
                                    <!-- Will be populated via JavaScript -->
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Containment Tab -->
                        <div class="tab-pane fade" id="containment" role="tabpanel" aria-labelledby="containment-tab">
                            <div class="card mb-3">
                                <div class="card-header">Add Containment Action</div>
                                <div class="card-body">
                                    <form id="containment-form" class="row g-3">
                                        <div class="col-md-4">
                                            <label for="action-type" class="form-label">Action Type</label>
                                            <select class="form-select" id="action-type" required>
                                                <option value="">Select type...</option>
                                                <option value="isolation">System Isolation</option>
                                                <option value="block">IP/User Blocking</option>
                                                <option value="credential_reset">Credential Reset</option>
                                                <option value="patch">Security Patch</option>
                                                <option value="config">Configuration Change</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                        <div class="col-md-8">
                                            <label for="action-description" class="form-label">Description</label>
                                            <input type="text" class="form-control" id="action-description" required>
                                        </div>
                                        <div class="col-md-12">
                                            <label for="action-details" class="form-label">Details (Optional)</label>
                                            <textarea class="form-control" id="action-details" rows="2"></textarea>
                                        </div>
                                        <div class="col-12 text-end">
                                            <button type="button" class="btn btn-primary" id="add-action-btn">Add Containment Action</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>Action Type</th>
                                            <th>Description</th>
                                            <th>Status</th>
                                            <th>Created</th>
                                            <th>Updated</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="containment-actions">
                                        <!-- Will be populated via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Evidence Tab -->
                        <div class="tab-pane fade" id="evidence" role="tabpanel" aria-labelledby="evidence-tab">
                            <div class="card mb-3">
                                <div class="card-header">Add Evidence</div>
                                <div class="card-body">
                                    <form id="evidence-form" class="row g-3">
                                        <div class="col-md-4">
                                            <label for="evidence-type" class="form-label">Evidence Type</label>
                                            <select class="form-select" id="evidence-type" required>
                                                <option value="">Select type...</option>
                                                <option value="log">Log File</option>
                                                <option value="network">Network Capture</option>
                                                <option value="memory">Memory Dump</option>
                                                <option value="disk">Disk Image</option>
                                                <option value="screenshot">Screenshot</option>
                                                <option value="email">Email</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                        <div class="col-md-8">
                                            <label for="evidence-description" class="form-label">Description</label>
                                            <input type="text" class="form-control" id="evidence-description" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="evidence-location" class="form-label">Storage Location</label>
                                            <input type="text" class="form-control" id="evidence-location" required placeholder="Where the evidence is stored">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="evidence-metadata" class="form-label">Metadata (Optional)</label>
                                            <input type="text" class="form-control" id="evidence-metadata" placeholder="JSON format: {'key': 'value', ...}">
                                        </div>
                                        <div class="col-12 text-end">
                                            <button type="button" class="btn btn-primary" id="add-evidence-btn">Add Evidence</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>Type</th>
                                            <th>Description</th>
                                            <th>Location</th>
                                            <th>Collected At</th>
                                            <th>Collector</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="evidence-items">
                                        <!-- Will be populated via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Modal -->
<div class="modal fade" id="statsModal" tabindex="-1" aria-labelledby="statsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="statsModalLabel">Incident Statistics</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header">Incidents by Severity</div>
                            <div class="card-body">
                                <canvas id="severityChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header">Incidents by Status</div>
                            <div class="card-body">
                                <canvas id="statusChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header">Incidents by Type</div>
                            <div class="card-body">
                                <canvas id="typeChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header">Incidents by Month</div>
                            <div class="card-body">
                                <canvas id="timeChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">Summary Statistics</div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <p><strong>Total Incidents:</strong> <span id="stats-total"></span></p>
                                        <p><strong>Open Incidents:</strong> <span id="stats-open"></span></p>
                                        <p><strong>Resolved Incidents:</strong> <span id="stats-resolved"></span></p>
                                    </div>
                                    <div class="col-md-4">
                                        <p><strong>Critical Incidents:</strong> <span id="stats-critical"></span></p>
                                        <p><strong>High Severity:</strong> <span id="stats-high"></span></p>
                                        <p><strong>Medium/Low Severity:</strong> <span id="stats-medium-low"></span></p>
                                    </div>
                                    <div class="col-md-4">
                                        <p><strong>Avg. Resolution Time:</strong> <span id="stats-resolution-time"></span></p>
                                        <p><strong>Most Common Type:</strong> <span id="stats-common-type"></span></p>
                                        <p><strong>Date Range:</strong> <span id="stats-date-range"></span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="export-stats">Export Statistics</button>
            </div>
        </div>
    </div>
</div>

<!-- Update Action Status Modal -->
<div class="modal fade" id="updateActionModal" tabindex="-1" aria-labelledby="updateActionModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateActionModalLabel">Update Containment Action</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="update-action-form">
                    <input type="hidden" id="update-action-id">
                    <div class="mb-3">
                        <label for="action-current-status" class="form-label">Current Status</label>
                        <input type="text" class="form-control" id="action-current-status" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="action-new-status" class="form-label">New Status</label>
                        <select class="form-select" id="action-new-status" required>
                            <option value="">Select new status...</option>
                            <option value="pending">Pending</option>
                            <option value="in_progress">In Progress</option>
                            <option value="completed">Completed</option>
                            <option value="failed">Failed</option>
                            <option value="not_applicable">Not Applicable</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="action-status-notes" class="form-label">Notes</label>
                        <textarea class="form-control" id="action-status-notes" rows="3" placeholder="Optional notes about the status update"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="save-action-status">Update Status</button>
            </div>
        </div>
    </div>
</div>
